"use strict";(self.webpackChunk_ant_design_pro_flow_editor=self.webpackChunk_ant_design_pro_flow_editor||[]).push([[707],{38707:function(oe,K,d){d.d(K,{d:function(){return L}});var T=d(57213),M=d.n(T),$=d(12342),R=d.n($),O=d(80111),w=d(50959),N=d(47018),W=["yjsDoc","flattenEdges","selectedKeys","onFlattenNodesChange","onEdgesChange","onFlattenEdgesChange","onNodesChange","onViewPortChange","onNodesTreeChange","onSelectionChange","onElementSelectChange","updateEdgesOnEdgeChange","updateEdgesOnConnection","internalUpdateEdges","internalUpdateNodes","internalUpdateSelection"],L=function(){var D=(0,N.AC)(),f=D.getState(),B=f.yjsDoc,Q=f.flattenEdges,x=f.selectedKeys,X=f.onFlattenNodesChange,y=f.onEdgesChange,b=f.onFlattenEdgesChange,J=f.onNodesChange,z=f.onViewPortChange,k=f.onNodesTreeChange,m=f.onSelectionChange,q=f.onElementSelectChange,ee=f.updateEdgesOnEdgeChange,G=f.updateEdgesOnConnection,te=f.internalUpdateEdges,_=f.internalUpdateNodes,v=f.internalUpdateSelection,H=R()(f,W),j=(0,O.Z)(function(){return D.getState().flattenNodes}),F=(0,O.Z)(function(){return D.getState().flattenEdges}),I=(0,O.Z)(function(){return D.getState().selectedKeys});return(0,w.useMemo)(function(){return M()(M()({},H),{},{getFlattenNodes:j,getSelectedKeys:I,getFlattenEdges:F})},[H])}},47018:function(oe,K,d){d.d(K,{zt:function(){return Ne},ze:function(){return me},AC:function(){return Ce}});var T=d(7582),M=d(29287),$=d(64750),R=d(54306),O=d.n(R),w=d(68608),N=d.n(w),W=d(58853),L=d.n(W),Z=d(38888),D=d.n(Z),f=d(63466),B=d.n(f),Q=d(21140),x=d.n(Q),X=d(52510),y=d.n(X),b=d(94682),J=B()(function E(s){x()(this,E),y()(this,"type",void 0),y()(this,"name",void 0),y()(this,"timestamp",void 0),this.type=s.type,this.name=s.name,this.timestamp=s.timestamp}),z=function(E){L()(t,E);var s=D()(t);function t(o){var e;return x()(this,t),e=s.call(this,o),y()(N()(e),"_internalHistoryKey","__INTERNAL_HISTORY_MAP__"),y()(N()(e),"undoManager",void 0),y()(N()(e),"updateHistoryData",function(n){var a=e.getMap(e._internalHistoryKey);Object.entries(n).forEach(function(r){var l=O()(r,2),c=l[0],i=l[1];a.set(c,i)})}),y()(N()(e),"recordHistoryData",function(n,a){e.transact(function(){e.updateHistoryData(n)},new J(a))}),y()(N()(e),"getHistoryMap",function(){return e.getMap(e._internalHistoryKey)}),y()(N()(e),"getHistoryJSON",function(){var n=e.getMap(e._internalHistoryKey);return n.toJSON()}),y()(N()(e),"redo",function(){return e.undoManager.redo()}),y()(N()(e),"undo",function(){return e.undoManager.undo()}),e.undoManager=new b.H6(e.getHistoryMap(),{trackedOrigins:new Set([J])}),e}return B()(t)}(b.QW),k=d(57213),m=d.n(k),q={reactflow:{},flattenNodes:{},flattenEdges:{},selectedKeys:[],yjsDoc:new z},ee=d(12342),G=d.n(ee),te=d(3341),_=d.n(te),v=d(16391),H="$$",j="@@",F=function(s,t){return s+j+(t||"")},I=function(s,t,o,e){return F(s,o)+H+F(t,e)},Se=function(s){var t=s.split(H),o=_slicedToArray(t,2),e=o[0],n=o[1];if(!e||!n)return{source:"",target:"",sourceHandle:"",targetHandle:""};var a=e.split(j),r=_slicedToArray(a,2),l=r[0],c=r[1],i=n.split(j),u=_slicedToArray(i,2),p=u[0],C=u[1];return{source:l,target:p,sourceHandle:c,targetHandle:C}},ae=function(s,t){switch(t.type){case"addEdge":return(0,v.Uy)(s,function(o){o[t.edge.id]=t.edge});case"addEdges":return(0,v.Uy)(s,function(o){var e=t.edges;e&&Object.keys(e).forEach(function(n){o[n]||(o[n]=e[n])})});case"updateEdge":return(0,v.Uy)(s,function(o){var e=t.id,n=t.edge;o[e]=m()(m()({},o[e]),n)});case"deleteEdge":return(0,v.Uy)(s,function(o){delete o[t.id]});case"createEdgeFromConnection":return(0,v.Uy)(s,function(o){var e=t.connection,n=e.source,a=e.target,r=e.sourceHandle,l=e.targetHandle;if(!(!n||!a)){var c=I(n,a,r,l);o[c]={id:c,source:n,target:a,sourceHandle:r,targetHandle:l}}});default:return s}},re=["type"],de=function(s,t){return{internalUpdateEdges:function(e,n){var a,r;s({flattenEdges:e},!1,n),(a=(r=t()).onFlattenEdgesChange)===null||a===void 0||a.call(r,e)},dispatchEdges:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{recordHistory:!0},a=n.recordHistory,r=a===void 0?!0:a,l=e.type,c=G()(e,re),i=ae(t().flattenEdges,e);if(!_()(i,t().flattenEdges)){var u=t(),p=u.internalUpdateEdges,C=u.yjsDoc;p(i,{type:"dispatchFlattenEdges/".concat(l),payload:c}),r&&C.recordHistoryData({flattenEdges:i},{type:"edge",name:e.type,timestamp:Date.now()})}},addEdges:function(e,n){t().dispatchEdges({type:"addEdges",edges:e},n)},updateEdgesOnConnection:function(e){t().dispatchEdges({type:"createEdgeFromConnection",connection:e})},updateEdgesOnEdgeChange:function(e){e.forEach(function(n){switch(n.type){case"remove":t().dispatchEdges({type:"deleteEdge",id:n.id})}})}}},se=function(s,t){switch(t.type){case"addNode":return(0,v.Uy)(s,function(o){!t.node||!t.node.id||(o[t.node.id]=t.node)});case"addNodes":return(0,v.Uy)(s,function(o){var e=t.nodes;e&&Object.keys(e).forEach(function(n){o[n]||(o[n]=e[n])})});case"deleteNode":return(0,v.Uy)(s,function(o){delete o[t.id]});case"updateNodePosition":return(0,v.Uy)(s,function(o){o[t.id]&&t.position&&(o[t.id].position=t.position)});case"updateNodeMeta":return(0,v.Uy)(s,function(o){if(o[t.id]){var e=o[t.id];e.data.meta[t.key]=t.value}});case"updateNodeState":return(0,v.Uy)(s,function(o){if(o[t.id]){var e=o[t.id];e.data.state[t.key]=t.value}});case"updateNodeContent":return(0,v.Uy)(s,function(o){var e=t.key,n=t.id,a=t.value;if(o[n]){var r=o[n];r.data.content?r.data.content[e]=a:r.data.content=y()({},e,a)}});default:return s}},le=["type"],ie=function(s,t){return{internalUpdateNodes:function(e,n){var a,r;_()(e,t().flattenNodes)||(s({flattenNodes:e},!1,n),(a=(r=t()).onFlattenNodesChange)===null||a===void 0||a.call(r,e))},dispatchNodes:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{recordHistory:!0},a=n.recordHistory,r=a===void 0?!0:a,l=e.type,c=G()(e,le),i=se(t().flattenNodes,e);if(!_()(i,t().flattenNodes)){t().internalUpdateNodes(i,{type:"dispatchFlattenNodes/".concat(l),payload:c});var u=t(),p=u.yjsDoc;r&&p.recordHistoryData({flattenNodes:i},{type:"nodes",name:e.type,timestamp:Date.now()})}},updateNodeMeta:function(e,n,a,r){t().dispatchNodes({type:"updateNodeMeta",id:e,key:n,value:a},r)},updateNodeState:function(e,n,a,r){t().dispatchNodes({type:"updateNodeState",id:e,key:n,value:a},r)},updateNodeContent:function(e,n,a,r){t().dispatchNodes({type:"updateNodeContent",id:e,key:n,value:a},r)},addNode:function(e){t().dispatchNodes({type:"addNode",node:e})},addNodes:function(e,n){t().dispatchNodes({type:"addNodes",nodes:e},n)},deleteNode:function(e){t().dispatchNodes({type:"deleteNode",id:e})}}},ce=d(54689),ue=d.n(ce),fe=d(25359),P=d.n(fe),ge=d(49811),ne=d.n(ge),pe=d(93525),A=d.n(pe),ye=d(67197),ve=(0,ye.kP)("0123456789abcdefghijklmnopqrstuvwxyz",16),Ee=function(s,t){return{internalUpdateSelection:function(e,n){var a,r;s({selectedKeys:e},!1,n),(a=(r=t()).onSelectionChange)===null||a===void 0||a.call(r,e)},onElementSelectChange:function(e,n){n?t().selectElement(e):t().deselectElement(e)},actionList:function(){var e=t(),n=e.yjsDoc;return{undo:n.undoManager.undoStack.length,redo:n.undoManager.redoStack.length}},selectElement:function(e){t().selectedKeys.includes(e)||t().internalUpdateSelection([].concat(A()(t().selectedKeys),[e]),{type:"selection/selectElement",payload:{id:e}})},selectElements:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;t().internalUpdateSelection(n?[].concat(A()(t().selectedKeys),A()(e)):e,{type:"selection/selectElements",payload:{ids:e}})},selectAll:function(){var e=t().reactflow.getNodes(),n=t().reactflow.getEdges(),a=[].concat(A()(e.map(function(r){return r.id})),A()(n.map(function(r){return r.id})));t().internalUpdateSelection(a,{type:"selection/selectAll",payload:{ids:a}})},deselectElement:function(e){t().internalUpdateSelection(t().selectedKeys.filter(function(n){return n!==e}),{type:"selection/deselectElement",payload:{id:e}})},deselectAll:function(){t().internalUpdateSelection([],{type:"selection/deselectAll",payload:{}})},deleteSelection:function(){var e=t(),n=e.selectedKeys,a=e.flattenEdges,r=e.flattenNodes,l=e.dispatchNodes,c=e.dispatchEdges;n.forEach(function(i){r[i]&&l({type:"deleteNode",id:i}),a[i]&&c({type:"deleteEdge",id:i})})},copySelection:function(){var o=ne()(P()().mark(function n(){var a,r,l,c,i,u,p,C,g,h;return P()().wrap(function(U){for(;;)switch(U.prev=U.next){case 0:if(a=t(),r=a.selectedKeys,l=a.flattenEdges,c=a.flattenNodes,r.length!==0){U.next=3;break}return U.abrupt("return");case 3:return i=Object.values(c).filter(function(Y){return r.includes(Y.id)}),u=Object.values(l).filter(function(Y){return r.includes(Y.id)}),p={nodes:i,edges:u},C=new Blob([JSON.stringify(p)],{type:"text/html"}),g=new Blob([JSON.stringify(p)],{type:"text/plain"}),h=new ClipboardItem({"text/html":C,"text/plain":g}),U.next=11,navigator.clipboard.write([h]);case 11:return U.abrupt("return",p);case 12:case"end":return U.stop()}},n)}));function e(){return o.apply(this,arguments)}return e}(),paste:function(){var o=ne()(P()().mark(function n(){var a;return P()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,navigator.clipboard.read();case 2:a=l.sent,a.forEach(function(c){var i=ue()(c.types),u;try{for(i.s();!(u=i.n()).done;){var p=u.value;if(p==="text/plain"){var C=c.getType(p);C.then(function(g){g.text().then(function(h){var S=void 0;try{S=JSON.parse(h)}catch(U){}S&&t().pasteIntoFlow(S)})})}}}catch(g){i.e(g)}finally{i.f()}});case 4:case"end":return l.stop()}},n)}));function e(){return o.apply(this,arguments)}return e}(),pasteIntoFlow:function(e){var n=t(),a=n.yjsDoc,r=n.addEdges,l=n.addNodes,c=n.deselectAll,i=n.selectElements,u={},p={};c(),e.nodes.forEach(function(g){var h=ve();u[h]=m()(m()({},g),{},{id:h,position:{x:g.position.x+10,y:g.position.y+10}}),e.edges.forEach(function(S){S.source===g.id&&(S.source=h),S.target===g.id&&(S.target=h)})}),e.edges.forEach(function(g){var h=I(g.source,g.target,g.sourceHandle,g.targetHandle);p[h]=m()(m()({},g),{},{id:h})}),l(u,{recordHistory:!1}),r(p,{recordHistory:!1}),a.recordHistoryData({flattenNodes:t().flattenNodes,flattenEdges:t().flattenEdges},{type:"paste",name:"\u7C98\u8D34",timestamp:Date.now()});var C=Object.keys(u).concat(Object.keys(p));i(C)},undo:function(){var e=t(),n=e.yjsDoc,a=e.internalUpdateEdges,r=e.internalUpdateNodes,l=n.undo(),c=n.getHistoryJSON(),i=c.flattenNodes,u=c.flattenEdges;r(i,{type:"history/undo",payload:l}),a(u,{type:"history/undo",payload:l})},redo:function(){var e=t(),n=e.yjsDoc,a=e.internalUpdateEdges,r=e.internalUpdateNodes,l=n.redo(),c=n.getHistoryJSON(),i=c.flattenNodes,u=c.flattenEdges;r(i,{type:"history/redo",payload:l}),a(u,{type:"history/redo",payload:l})}}},he=function(s){return function(){return m()(m()(m()(m()({},q),{},{yjsDoc:s},de.apply(void 0,arguments)),ie.apply(void 0,arguments)),Ee.apply(void 0,arguments))}},me=function(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,t=new z;return(0,T.Ue)()((0,M.v)(s)(he(t),{name:"FLOW_EDITOR"}))},V=(0,$.k)(),Ne=V.Provider,Ue=V.useStore,Ce=V.useStoreApi}}]);
